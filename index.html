<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>THE EMPIRE ¬∑ Command Center</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-0:#0d1a27; --bg-1:#0f2233; --bg-2:#122a3f; --bg-3:#0b1825;
      --card:#0f2233; --card-2:#132a42; --muted:#7c97b5; --text:#eaf2ff; --accent:#ffd559;
      --good:#1dd1a1; --warn:#ffb142; --bad:#ff6b6b; --line:#173046;
      --shadow:0 6px 24px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.02);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      color:var(--text); background:
        radial-gradient(1200px 1200px at 120% -10%, #163b5c 0%, transparent 60%) fixed,
        radial-gradient(1000px 1000px at -10% 120%, #0c2338 0%, transparent 60%) fixed,
        var(--bg-0);
    }
    /* Sidebar / Layout */
    .page{display:grid; grid-template-columns:260px 1fr; min-height:100vh}
    .sidebar{background:linear-gradient(180deg,#0d1a27 0%, #0b1825 100%);
      border-right:1px solid var(--line); padding:18px 12px;}
    .brand{display:flex; align-items:center; gap:10px; padding:8px 10px 18px}
    .brand img{width:28px;height:28px}
    .brand span{font-weight:800}
    .nav{display:flex; flex-direction:column; gap:6px}
    .nav a{padding:11px 12px; text-decoration:none; color:var(--text); border-radius:10px}
    .nav a.active{background:var(--bg-2)}
    .content{padding:22px; min-width:0}
    /* Cards */
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow)}
    .card.pad{padding:16px}
    .kpi .label{font-size:12px; color:var(--muted)}
    .kpi .value{font-weight:800; font-size:22px}
    table{width:100%; border-collapse:collapse}
    thead th{background:#0f2b45; padding:8px; font-size:12px}
    tbody td{padding:8px; border-top:1px solid var(--line)}
    .muted{color:var(--muted)}
    .money{color:var(--good); font-weight:700}
  </style>
</head>
<body>
<div class="page">
  <aside class="sidebar">
    <div class="brand">
      <img src="https://i.imgur.com/2sGv2cH.png" alt="empire">
      <span>THE EMPIRE</span>
    </div>
    <nav class="nav" id="nav">
      <a href="#dashboard" data-route="dashboard" class="active">üè† Dashboard</a>
      <a href="#cpa" data-route="cpa">üëë CPA Accounts</a>
      <a href="#users" data-route="users">üë• Users</a>
      <a href="#analytics" data-route="analytics">üìä Analytics</a>
      <a href="#wallet" data-route="wallet">üí≥ Wallet</a>
      <a href="#monitor" data-route="monitor">üõ° Monitoring</a>
      <a href="#settings" data-route="settings">‚öô Settings</a>
    </nav>
  </aside>

  <main class="content">
    <!-- Dashboard -->
    <section data-page="dashboard" style="display:block">
      <h2>Supreme Command Dashboard</h2>
      <div class="card pad kpi"><div class="label">Total Earnings</div><div class="value" id="dash-earn">$0.00</div></div>
      <div class="card pad kpi"><div class="label">Total Clicks</div><div class="value" id="dash-clicks">0</div></div>
      <div class="card pad kpi"><div class="label">Conversion Rate</div><div class="value" id="dash-cr">0%</div></div>
      <div class="card pad kpi"><div class="label">Active Users</div><div class="value" id="dash-users">0</div></div>
      <h3>By Geo</h3>
      <table><thead><tr><th>Country</th><th>Clicks</th><th>Leads</th><th>Earnings</th></tr></thead>
        <tbody id="tbl-dash-geo"><tr><td colspan="4" class="muted">No data</td></tr></tbody></table>
    </section>

    <!-- CPA Accounts -->
    <section data-page="cpa" style="display:none">
      <h2>CPA Accounts</h2>
      <div id="cpa-grid"></div>
    </section>

    <!-- Users -->
    <section data-page="users" style="display:none">
      <h2>Users Management</h2>
      <div id="tbl-users" class="card pad">Loading‚Ä¶</div>
    </section>

    <!-- Analytics -->
    <section data-page="analytics" style="display:none">
      <h2>Analytics</h2>
      <div id="ana-overview" class="card pad">Loading‚Ä¶</div>
      <table><thead><tr><th>Time</th><th>Country</th><th>Offer</th><th>Clicks</th><th>Conv</th><th>Earnings</th></tr></thead>
      <tbody id="tbl-live-perf"><tr><td colspan="6">Waiting‚Ä¶</td></tr></tbody></table>
    </section>

    <!-- Wallet -->
    <section data-page="wallet" style="display:none">
      <h2>Wallet</h2>
      <div id="wal-balance" class="card pad">$0.00</div>
      <table><thead><tr><th>Date</th><th>Method</th><th>Amount</th><th>Status</th></tr></thead>
      <tbody id="tbl-wallet"><tr><td colspan="4">No tx</td></tr></tbody></table>
    </section>

    <!-- Monitoring -->
    <section data-page="monitor" style="display:none">
      <h2>Monitoring</h2>
      <div id="tbl-monitor" class="card pad">No events</div>
    </section>

    <!-- Settings -->
    <section data-page="settings" style="display:none">
      <h2>Settings</h2>
      <pre id="pretty">{‚Ä¶}</pre>
    </section>
  </main>
</div>

<script>
/* ========= CONFIG ========= */
const GAS = "https://script.google.com/macros/s/AKfycbwZVlGMvYonfCNdQlwPHiqqgOVC80_HsyktSYmqmQPBKmRrlzg_yo4lKz_Mmu85B7eY/exec";
const POLL_FAST = 5000;
const $  = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const dollars = n => Number(n||0).toLocaleString(undefined,{style:'currency',currency:'USD'});

/* GET helper */
const get = async (url, opt={})=>{
  const u = new URL(url); u.searchParams.set('_t', Date.now());
  const r = await fetch(u,{cache:'no-store',...opt});
  if(!r.ok) throw new Error('HTTP '+r.status); return r.json();
};
const api = (action, params={})=>{
  const u=new URL(GAS); u.searchParams.set('action',action);
  Object.entries(params).forEach(([k,v])=>u.searchParams.set(k,v));
  return get(u);
};

/* Router */
function show(route){
  $$('.nav a').forEach(a=>a.classList.toggle('active',a.dataset.route===route));
  $$('[data-page]').forEach(s=>s.style.display=(s.dataset.page===route)?'block':'none');
  if(route==='dashboard') initDashboard();
  if(route==='cpa') initCpa();
  if(route==='users') initUsers();
  if(route==='analytics') initAnalytics();
  if(route==='wallet') initWallet();
  if(route==='monitor') initMonitor();
  if(route==='settings') initSettings();
}
window.addEventListener('hashchange',()=>{const r=location.hash.replace('#','')||'dashboard';show(r);});
$('#nav').addEventListener('click',e=>{if(e.target.closest('a')){location.hash='#'+e.target.closest('a').dataset.route;}});

/* Dashboard */
async function initDashboard(){
  try{
    const ov = await api('overview');
    $('#dash-earn').textContent=dollars(ov?.totals?.earnings||0);
    $('#dash-clicks').textContent=ov?.totals?.clicks||0;
    $('#dash-cr').textContent=(ov?.totals?.conversionRate||0).toFixed(2)+'%';
    $('#dash-users').textContent=ov?.totals?.users||0;
    const geo=ov?.geo||{};
    const tb=$('#tbl-dash-geo');tb.innerHTML='';
    Object.entries(geo).forEach(([c,v])=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${c}</td><td>0</td><td>0</td><td class="money">${dollars(v)}</td>`;
      tb.appendChild(tr);
    });
  }catch(e){console.error(e);}
}

/* CPA */
async function initCpa(){
  const wrap=$('#cpa-grid');wrap.innerHTML='';
  try{
    const resp=await api('cpa');const items=resp.items||[];
    if(!items.length){wrap.innerHTML='<div>No CPA accounts</div>';return;}
    items.forEach(r=>{
      const div=document.createElement('div');
      div.className='card pad';
      div.innerHTML=`<h3>${r.accountid}</h3><p>${r.network}</p><p>${dollars(r.revenue)}</p>`;
      wrap.appendChild(div);
    });
  }catch(e){wrap.innerHTML='Error loading';}
}

/* Users */
async function initUsers(){
  const tb=$('#tbl-users');tb.innerHTML='';
  try{
    const resp=await api('users');const items=resp.items||[];
    items.forEach(u=>{
      const div=document.createElement('div');
      div.textContent=`${u.name} (${u.status})`;tb.appendChild(div);
    });
  }catch(e){tb.innerHTML='Error';}
}

/* Analytics */
async function initAnalytics(){
  try{
    const resp=await api('analytics');$('#ana-overview').textContent=JSON.stringify(resp);
    const tb=$('#tbl-live-perf');tb.innerHTML='';
    (resp.live||[]).forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.time}</td><td>${r.country}</td><td>${r.offer}</td><td>${r.clicks}</td><td>${r.conv}</td><td>${dollars(r.earnings)}</td>`;
      tb.appendChild(tr);
    });
  }catch(e){$('#ana-overview').textContent='Error';}
}

/* Wallet */
async function initWallet(){
  try{
    const resp=await api('wallet');$('#wal-balance').textContent=dollars(resp.balance||0);
    const tb=$('#tbl-wallet');tb.innerHTML='';
    (resp.history||[]).forEach(t=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${t.date}</td><td>${t.method}</td><td>${dollars(t.amount)}</td><td>${t.status}</td>`;
      tb.appendChild(tr);
    });
  }catch(e){$('#wal-balance').textContent='Error';}
}

/* Monitoring */
async function initMonitor(){
  try{
    const resp=await api('monitoring');$('#tbl-monitor').textContent=JSON.stringify(resp.events||[]);
  }catch(e){$('#tbl-monitor').textContent='Error';}
}

/* Settings */
async function initSettings(){
  try{
    const resp=await api('config');$('#pretty').textContent=JSON.stringify(resp,null,2);
  }catch(e){$('#pretty').textContent='Error';}
}

/* Boot */
window.addEventListener('DOMContentLoaded',()=>{const r=(location.hash||'#dashboard').replace('#','');show(r);});
</script>
</body>
</html>