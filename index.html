<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>⚔️ The Empire Dashboard ⚔️</title>
  <style>
    :root{
      --bg:#0b1424; --panel:#0f172a; --card:#111; --accent:#ffd166; --muted:#9fb3c8; --line:#1f2a44;
    }
    body{margin:0;font-family:Arial,system-ui,sans-serif;background:var(--bg);color:#e6f1ff}
    .layout{display:flex;min-height:100vh}
    nav{width:240px;background:var(--panel);padding:20px;box-sizing:border-box}
    nav h2{color:var(--accent);margin:0 0 16px}
    .navlink{display:block;padding:10px 12px;margin:6px 0;border-radius:8px;color:#e6f1ff;text-decoration:none}
    .navlink:hover{background:#1b2742}
    .navlink.active{background:#223157;box-shadow:inset 0 0 0 1px #2d416f}
    main{flex:1;padding:20px;overflow-y:auto}
    .card{background:var(--card);border-radius:12px;padding:16px;margin-bottom:20px;box-shadow:0 2px 5px rgba(0,0,0,.4)}
    .card h3{margin:0 0 10px;color:var(--accent)}
    h4{margin:14px 0 6px}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px 10px;border:1px solid var(--line)}
    th{background:#1f2a44}
    .muted{color:var(--muted)}
    .num{text-align:right}
    input,select,button{padding:10px 12px;margin-top:8px;border-radius:8px;border:1px solid var(--line);background:#0b1320;color:#e6f1ff}
    button{background:var(--accent);color:#000;border:none;font-weight:700;cursor:pointer}
    button:hover{filter:brightness(0.95)}
    /* tab views */
    .view{display:none}
    .view.active{display:block}
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <nav>
      <h2>⚔️ Empire</h2>
      <a class="navlink" href="#overview"   data-target="overview">Overview</a>
      <a class="navlink" href="#cpa"        data-target="cpa">CPA Accounts</a>
      <a class="navlink" href="#users"      data-target="users">Users</a>
      <a class="navlink" href="#analytics"  data-target="analytics">Analytics</a>
      <a class="navlink" href="#wallet"     data-target="wallet">Wallet</a>
      <a class="navlink" href="#monitoring" data-target="monitoring">Monitoring</a>
      <a class="navlink" href="#settings"   data-target="settings">Settings</a>
    </nav>

    <!-- Main Content -->
    <main>
      <!-- Overview -->
      <section id="overview" class="view active card">
        <h3>Overview</h3>
        <p>Earnings: <span id="ov-earnings">$0.00</span></p>
        <p>Leads: <span id="ov-leads">0.00</span></p>
        <p>Clicks: <span id="ov-clicks">0.00</span></p>
        <p>Conversion Rate: <span id="ov-convrate">0.00%</span></p>
        <p>EPC: <span id="ov-epc">$0.00</span></p>
        <p>CPA: <span id="ov-cpa">$0.00</span></p>
        <p>RPM: <span id="ov-rpm">$0.00</span></p>

        <h4>By Geo</h4>
        <div id="tbl-geo"></div>
        <h4>By Device</h4>
        <div id="tbl-device"></div>
        <h4>By Offer Type</h4>
        <div id="tbl-offerType"></div>
        <h4>By Day</h4>
        <div id="tbl-byDay"></div>
      </section>

      <!-- CPA Accounts -->
      <section id="cpa" class="view card">
        <h3>CPA Accounts Management</h3>
        <div id="cpaAccounts"></div>
      </section>

      <!-- Users -->
      <section id="users" class="view card">
        <h3>Users Management</h3>
        <table>
          <thead><tr><th>Name</th><th>Email</th><th>Phone</th></tr></thead>
          <tbody id="usersBody"></tbody>
        </table>
        <h4>Invite Link</h4>
        <input id="inviteLink" type="text" readonly style="width:100%" />
        <input id="inviteRef" type="text" readonly style="width:100%;margin-top:5px;" />
      </section>

      <!-- Analytics -->
      <section id="analytics" class="view card">
        <h3>Analytics & Reports</h3>
        <table>
          <thead><tr><th>Date</th><th>Clicks</th><th>Leads</th><th>Earnings</th></tr></thead>
          <tbody id="analyticsBody"></tbody>
        </table>
      </section>

      <!-- Wallet -->
      <section id="wallet" class="view card">
        <h3>Wallet & Withdrawal</h3>
        <p>Total In: <span id="wallet-totalIn">$0.00</span></p>
        <p>Total Out: <span id="wallet-totalOut">$0.00</span></p>
        <p>Balance: <span id="wallet-balance">$0.00</span></p>

        <form onsubmit="return false;">
          <input id="acctNumber" type="text" placeholder="Account Number" /><br/>
          <select id="bankSelect"><option>Loading banks...</option></select><br/>
          <input id="withdrawAmt" type="number" placeholder="Amount (USD)" /><br/>
          <button type="button" onclick="alert('Withdraw requested')">Withdraw</button>
        </form>
      </section>

      <!-- Monitoring -->
      <section id="monitoring" class="view card">
        <h3>Monitoring</h3>
        <p>Overall Health: <span id="mon-health">0.00%</span></p>
        <ul id="mon-feed"></ul>
      </section>

      <!-- Settings -->
      <section id="settings" class="view card">
        <h3>System & Authority Settings</h3>
        <table>
          <thead><tr><th>Key</th><th>Value</th><th>Description</th><th>Updated</th></tr></thead>
          <tbody id="settingsBody"></tbody>
        </table>
      </section>
    </main>
  </div>

  <!-- Scripts: config first, then per-tab renderers -->
<script src="assets/js/config.js?v=5"></script>
<script src="assets/js/overview.js?v=5"></script>
<script src="assets/js/cpa.js?v=5"></script>
<script src="assets/js/users.js?v=5"></script>
<script src="assets/js/analytics.js?v=5"></script>
<script src="assets/js/wallet.js?v=5"></script>
<script src="assets/js/monitoring.js?v=5"></script>
<script src="assets/js/settings.js?v=5"></script>

  <!-- Tiny tab router -->
  <script>
    (function(){
      const links = Array.from(document.querySelectorAll(".navlink"));
      const views = Array.from(document.querySelectorAll(".view"));

      function show(tabId){
        // toggle active nav
        links.forEach(a => a.classList.toggle("active", a.dataset.target === tabId));
        // toggle visible section
        views.forEach(v => v.classList.toggle("active", v.id === tabId));

        // lazy-load per tab if needed
        try {
          if (tabId === "overview"   && typeof loadOverview   === "function") loadOverview();
          if (tabId === "cpa"        && typeof loadCPAAccounts=== "function") loadCPAAccounts();
          if (tabId === "users"      && typeof loadUsers      === "function") loadUsers();
          if (tabId === "analytics"  && typeof loadAnalytics  === "function") loadAnalytics();
          if (tabId === "wallet"     && typeof loadWallet     === "function") loadWallet();
          if (tabId === "monitoring" && typeof loadMonitoring === "function") loadMonitoring();
          if (tabId === "settings"   && typeof loadSettings   === "function") loadSettings();
        } catch(e){ console.error(e); }
      }

      // click handlers
      links.forEach(a => a.addEventListener("click", (ev)=>{
        ev.preventDefault();
        const id = a.dataset.target;
        history.replaceState(null, "", "#"+id);
        show(id);
      }));

      // initial route from hash (default: overview)
      const initial = (location.hash || "#overview").replace("#","");
      show(initial);
    })();
  </script>
<script>
(async function(){
  const API = "https://script.google.com/macros/s/AKfycbz-jj7Cr_KzqCku4SQPQ14MEIuCPdq5OEgiiqjo_O2A0FItBrHlmfkoJHViDxuX4P6z/exec";

  const $ = (id) => document.getElementById(id);
  const money = n => "$" + Number(n||0).toFixed(2);
  const pct   = n => Number(n||0).toFixed(2) + "%";

  function tableFromObject(obj, h1, h2){
    if (!obj || !Object.keys(obj).length) return "<p class='muted'>No data</p>";
    let html = `<table><thead><tr><th>${h1}</th><th>${h2}</th></tr></thead><tbody>`;
    for (const [k,v] of Object.entries(obj)) {
      html += `<tr><td>${k}</td><td class="num">${money(v)}</td></tr>`;
    }
    html += "</tbody></table>";
    return html;
  }

  try {
    const res = await fetch(API + "?_=" + Date.now(), {headers:{"Accept":"application/json"}});
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();
    console.log("DATA:", data);
    window.AppState = data;

    const t = data.totals || {};
    $("ov-earnings").textContent = money(t.earnings);
    $("ov-leads").textContent    = Number(t.leads||0).toFixed(0);
    $("ov-clicks").textContent   = Number(t.clicks||0).toFixed(0);
    $("ov-convrate").textContent = pct(t.conversionRate);
    $("ov-epc").textContent      = money(t.epc);
    $("ov-cpa").textContent      = money(t.cpa);
    $("ov-rpm").textContent      = money(t.rpm);

    $("tbl-geo").innerHTML        = tableFromObject(data.geo,        "Country",   "Earnings ($)");
    $("tbl-device").innerHTML     = tableFromObject(data.devices,    "Device",    "Earnings ($)");
    $("tbl-offerType").innerHTML  = tableFromObject(data.offerTypes, "Offer Type","Earnings ($)");
    $("tbl-byDay").innerHTML      = tableFromObject(data.byDay,      "Date",      "Earnings ($)");
  } catch (e) {
    console.error(e);
    alert("Overview load failed: " + e.message);
  }
})();
</script>
</body>
</html>