<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>THE EMPIRE AFFILIATE MARKETING HUB</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* ====== THEME (matches your screenshots exactly) ====== */
:root{
  --bg:#0c1b2a; --bg-soft:#0f2233; --bg-soft-2:#132a42;
  --ink:#eaf2ff; --muted:#8aa2bf; --accent:#ffd559;
  --good:#1dd1a1; --line:#183046;
  --radius:14px; --shadow:0 6px 20px rgba(0,0,0,.25),inset 0 1px 0 rgba(255,255,255,.02);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:Inter,system-ui,Segoe UI,Roboto; color:var(--ink);
  background:
    radial-gradient(900px 900px at 115% -10%, #163b5c 0%, transparent 60%) fixed,
    radial-gradient(900px 900px at -10% 120%, #0c2338 0%, transparent 60%) fixed,
    var(--bg);
}
.wrap{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
aside{background:#0a1a2a;border-right:1px solid #112a41}
.brand{display:flex;align-items:center;gap:10px;padding:16px 18px;font-weight:800;letter-spacing:.4px}
.brand .dot{width:8px;height:8px;border-radius:50%;background:#ffcc00}
.nav a{display:flex;align-items:center;gap:10px;padding:12px 16px;margin:6px 10px;border-radius:10px;color:#cde1ff;text-decoration:none}
.nav a.active,.nav a:hover{background:#122a3f}
main{padding:18px 22px}
.row{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
.card{background:linear-gradient(180deg,#0f2233,#0e2131);border:1px solid #173046;border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}
.card h3{margin:0 0 8px;font-size:14px;font-weight:700;color:#cfe2ff;letter-spacing:.3px}
.kpi{font-size:20px;font-weight:800}
.badge{display:inline-block;background:#14304a;border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-size:12px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px 12px;border-bottom:1px solid #15344d;font-size:13px}
.table thead th{background:#0f2b45;color:#cfe2ff;position:sticky;top:0;z-index:1}
.green{color:var(--good)} .muted{color:var(--muted)}
.grid-xs{grid-column:span 3} .grid-sm{grid-column:span 4} .grid-md{grid-column:span 6}
.grid-lg{grid-column:span 8} .grid-xl{grid-column:span 12}
.chart{min-height:220px}
.skeleton{position:relative;overflow:hidden;background:#10263d;border-radius:10px;min-height:180px}
.skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.06),transparent);
  transform:translateX(-100%);animation:sheen 1.2s infinite}
@keyframes sheen{to{transform:translateX(100%)}}
footer{color:#7ea2c6;font-size:12px;padding:14px;margin-top:10px;border-top:1px solid #15344d}
@media (max-width:980px){.wrap{grid-template-columns:82px 1fr}.nav a span{display:none}}
@media (max-width:720px){.row{grid-template-columns:1fr}.grid-xs,.grid-sm,.grid-md,.grid-lg,.grid-xl{grid-column:span 1}}
</style>
</head>
<body>
<div class="wrap">
  <aside>
    <div class="brand"><span class="dot"></span> THE EMPIRE</div>
    <nav class="nav">
      <a href="#dashboard"   id="nav-dashboard"   class="active">üè† <span>Dashboard</span></a>
      <a href="#cpa"         id="nav-cpa">üí≥ <span>CPA Accounts</span></a>
      <a href="#users"       id="nav-users">üë• <span>Users</span></a>
      <a href="#analytics"   id="nav-analytics">üìà <span>Analytics</span></a>
      <a href="#wallet"      id="nav-wallet">üíº <span>Payments/Wallet</span></a>
      <a href="#monitoring"  id="nav-monitoring">üñ•Ô∏è <span>Monitoring</span></a>
      <a href="#settings"    id="nav-settings">‚öôÔ∏è <span>Settings</span></a>
    </nav>
  </aside>

  <main>
    <!-- DASHBOARD -->
    <section id="view-dashboard" class="view">
      <div class="row">
        <div class="card grid-sm"><h3>Total Earnings</h3><div class="kpi" id="kpi-earnings">‚Äî</div><div class="muted" id="kpi-earnings-sub">vs last 7d</div></div>
        <div class="card grid-sm"><h3>Total Clicks</h3><div class="kpi" id="kpi-clicks">‚Äî</div><div class="muted">daily average</div></div>
        <div class="card grid-sm"><h3>Leads</h3><div class="kpi" id="kpi-leads">‚Äî</div></div>
        <div class="card grid-sm"><h3>Conversion Rate</h3><div class="kpi" id="kpi-conv">‚Äî</div><div class="muted">industry leading</div></div>

        <div class="card grid-md"><h3>Daily Earnings</h3><div id="dash-earnings" class="chart skeleton"></div></div>
        <div class="card grid-md"><h3>Traffic Sources</h3><div id="dash-sources" class="chart skeleton"></div></div>

        <div class="card grid-xl">
          <h3>By Geo (Top)</h3>
          <table class="table">
            <thead><tr><th>Country</th><th>Clicks</th><th>Leads</th><th>Earnings ($)</th></tr></thead>
            <tbody id="geo-table"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- CPA ACCOUNTS -->
    <section id="view-cpa" class="view" hidden>
      <div class="row" id="cpa-grid"></div>
    </section>

    <!-- USERS -->
    <section id="view-users" class="view" hidden>
      <div class="card grid-xl">
        <h3>Users Management</h3>
        <table class="table">
          <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Authority</th><th>Status</th></tr></thead>
          <tbody id="users-tb"></tbody>
        </table>
      </div>
    </section>

    <!-- ANALYTICS -->
    <section id="view-analytics" class="view" hidden>
      <div class="row">
        <div class="card grid-md"><h3>Performance Overview</h3><div id="ana-overview" class="chart skeleton"></div></div>
        <div class="card grid-md"><h3>Geographic Distribution</h3><div id="ana-geo-dist" class="chart skeleton"></div></div>
        <div class="card grid-xl">
          <h3>Live Performance Data</h3>
          <table class="table">
            <thead><tr><th>Time</th><th>Country</th><th>Offer Type</th><th>Device</th><th>Clicks</th><th>Leads</th><th>Earnings</th></tr></thead>
            <tbody id="ana-live"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- WALLET -->
    <section id="view-wallet" class="view" hidden>
      <div class="row">
        <div class="card grid-sm"><h3>Balance</h3><div class="kpi" id="wallet-balance">‚Äî</div></div>
        <div class="card grid-xl">
          <h3>Transaction History</h3>
          <table class="table">
            <thead><tr><th>Date</th><th>Method</th><th>Amount ($)</th><th>Status</th></tr></thead>
            <tbody id="wallet-history"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- MONITORING -->
    <section id="view-monitoring" class="view" hidden>
      <div class="row">
        <div class="card grid-sm"><h3>System Health</h3><div class="kpi" id="mon-health">‚Äî</div></div>
        <div class="card grid-sm"><h3>Maintenance</h3><div class="kpi" id="mon-maint">‚Äî</div></div>
        <div class="card grid-xl">
          <h3>Events Stream</h3>
          <table class="table">
            <thead><tr><th>Time</th><th>Type</th><th>Message</th></tr></thead>
            <tbody id="mon-events"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="view-settings" class="view" hidden>
      <div class="card grid-xl">
        <h3>Live Config</h3>
        <pre id="cfg" class="muted" style="white-space:pre-wrap"></pre>
      </div>
    </section>

    <footer>¬© THE EMPIRE ¬∑ Command Center</footer>
  </main>
</div>

<script>
/* ================== API CONFIG ================== */
const API_BASE = "https://script.google.com/macros/s/AKfycbyCjLNnMm0yQZeQ2PUn-zvNkWbp8vTpw-kZEu_zup6NiMW-ScR_cYwj59b4i09MgrdV/exec";
const api = async (action) => {
  const url = API_BASE + "?action=" + encodeURIComponent(action);
  const r = await fetch(url, {cache:"no-store"});
  if(!r.ok) throw new Error("HTTP "+r.status);
  return r.json();
};

/* ========== tiny SVG chart helpers (no libs) ========== */
const THEME = {accent:getCSS('--accent')||'#ffd559', axis:getCSS('--line')||'#173046', label:getCSS('--muted')||'#7c97b5'};
function getCSS(v){return getComputedStyle(document.documentElement).getPropertyValue(v).trim()}
const NS="http://www.w3.org/2000/svg";
function barChart(host, series=[], labels=[]){
  host.innerHTML=""; host.classList.remove('skeleton');
  if(!series.length){ host.textContent="No data"; return; }
  const W=host.clientWidth||320, H=220, pad=28, max=Math.max(...series,1), bw=(W-pad*2)/series.length;
  const svg=document.createElementNS(NS,'svg'); svg.setAttribute('viewBox',`0 0 ${W} ${H}`);
  const axis=document.createElementNS(NS,'line');
  axis.setAttribute('x1',pad);axis.setAttribute('y1',H-pad);axis.setAttribute('x2',W-pad);axis.setAttribute('y2',H-pad);
  axis.setAttribute('stroke',THEME.axis);axis.setAttribute('stroke-width','1'); svg.appendChild(axis);
  series.forEach((v,i)=>{
    const h=(v/max)*(H-pad*2), x=pad+i*bw+6, y=(H-pad)-h;
    const r=document.createElementNS(NS,'rect'); r.setAttribute('x',x); r.setAttribute('y',y);
    r.setAttribute('width',Math.max(8,bw-12)); r.setAttribute('height',Math.max(0,h)); r.setAttribute('rx','6');
    r.setAttribute('fill',THEME.accent); svg.appendChild(r);
    if(labels[i]){ const t=document.createElementNS(NS,'text'); t.setAttribute('x',x+(bw-12)/2); t.setAttribute('y',H-pad+14);
      t.setAttribute('text-anchor','middle'); t.setAttribute('font-size','10'); t.setAttribute('fill',THEME.label); t.textContent=labels[i]; svg.appendChild(t); }
  });
  host.appendChild(svg);
}
function pieChart(host, map={}){
  host.innerHTML=""; host.classList.remove('skeleton');
  const entries=Object.entries(map).filter(([,v])=>Number(v)>0); if(!entries.length){ host.textContent="No data"; return; }
  const W=240,H=220,R=90,CX=W/2,CY=H/2,total=entries.reduce((s,[,v])=>s+Number(v),0);
  const svg=document.createElementNS(NS,'svg'); svg.setAttribute('viewBox',`0 0 ${W} ${H}`);
  let angle=-Math.PI/2;
  entries.forEach(([k,v],i)=>{
    const frac=Number(v)/total, theta=frac*2*Math.PI;
    const x1=CX+R*Math.cos(angle), y1=CY+R*Math.sin(angle);
    const x2=CX+R*Math.cos(angle+theta), y2=CY+R*Math.sin(angle+theta);
    const p=document.createElementNS(NS,'path');
    p.setAttribute('d',`M ${CX} ${CY} L ${x1} ${y1} A ${R} ${R} 0 ${theta>Math.PI?1:0} 1 ${x2} ${y2} Z`);
    p.setAttribute('fill',THEME.accent); p.setAttribute('opacity',0.55+0.35*((i%3)/3)); svg.appendChild(p); angle+=theta;
  });
  host.appendChild(svg);
}

/* ================== ROUTER ================== */
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function show(route){
  $$('.nav a').forEach(a=>a.classList.toggle('active', a.id==='nav-'+route));
  $$('.view').forEach(v=>v.hidden = (v.id!=='view-'+route));
}
window.addEventListener('hashchange',()=> boot());
function fmtMoney(n){return 'US$'+Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}

/* ================== LOADERS ================== */
async function loadDashboard(){
  const d = await api('overview');
  $("#kpi-earnings").textContent = d.totalsPretty?.earningsUsd ?? fmtMoney(d.totals?.earnings);
  $("#kpi-clicks").textContent   = (d.totals?.clicks||0).toLocaleString();
  $("#kpi-leads").textContent    = (d.totals?.leads||0).toLocaleString();
  $("#kpi-conv").textContent     = d.totalsPretty?.conversionRatePct ?? ((d.totals?.conversionRate||0).toFixed(2)+'%');
  const byDay = (d.byDay||[]).map(x=>({label:String(x.date).slice(5), value:Number(x.earnings||0)}));
  barChart($("#dash-earnings"), byDay.map(x=>x.value), byDay.map(x=>x.label));
  pieChart($("#dash-sources"), d.devices || d.offerTypes || {});
  const geoT=$("#geo-table"); geoT.innerHTML='';
  (d.byGeo||[]).forEach(g=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${g.country}</td>
      <td>${(g.clicks||0).toLocaleString()}</td>
      <td>${(g.leads||0).toLocaleString()}</td>
      <td class="green">${fmtMoney(g.earnings)}</td>`;
    geoT.appendChild(tr);
  });
}

async function loadCpa(){
  const r = await api('cpa');
  const grid = $("#cpa-grid"); grid.innerHTML='';
  r.items.forEach(item=>{
    const card=document.createElement('div'); card.className='card grid-md';
    card.innerHTML=`
      <h3>${item.account} ¬∑ Network <b>${item.network}</b></h3>
      <div class="row" style="grid-template-columns:repeat(2,1fr);gap:8px">
        <div><span class="muted">Domain</span><div class="badge">${item.domain}</div></div>
        <div><span class="muted">Preferred Offer</span><div class="badge">${item.preferredOffer}</div></div>
      </div>
      <div style="margin-top:10px;display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
        <div><div class="muted">Active Offers</div><div class="kpi">${(item.activeOffers||0).toLocaleString()}</div></div>
        <div><div class="muted">Revenue</div><div class="kpi green">${fmtMoney(item.revenue)}</div></div>
        <div><div class="muted">Clicks</div><div class="kpi">${(item.clicks||0).toLocaleString()}</div></div>
      </div>
      <div class="muted" style="margin-top:6px">Conversion: ${(Number(item.conversionRate||0)*100).toFixed(2)}% ¬∑ Status: ${item.status}</div>
    `;
    grid.appendChild(card);
  });
}

async function loadUsers(){
  const r = await api('users');
  const tb=$("#users-tb"); tb.innerHTML='';
  r.items.forEach(u=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${u.name}</td><td>${u.email}</td><td>${u.phone}</td><td>${u.authority}</td><td>${u.status}</td>`;
    tb.appendChild(tr);
  });
}

async function loadAnalytics(){
  const d = await api('analytics');
  const byDay=(d.byDay||[]).map(x=>({label:String(x.date).slice(5), value:Number(x.earnings||0)}));
  barChart($("#ana-overview"), byDay.map(x=>x.value), byDay.map(x=>x.label));
  pieChart($("#ana-geo-dist"), d.geo || {});
  const live=$("#ana-live"); live.innerHTML='';
  (d.items||[]).forEach(i=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i.date}</td><td>${i.country}</td><td>${i.offertype}</td>
    <td>${i.device}</td><td>${(i.clicks||0).toLocaleString()}</td><td>${(i.leads||0).toLocaleString()}</td>
    <td class="green">${fmtMoney(i.earnings)}</td>`;
    live.appendChild(tr);
  });
}

async function loadWallet(){
  const w = await api('wallet');
  $("#wallet-balance").textContent = fmtMoney(w.balance);
  const tb=$("#wallet-history"); tb.innerHTML='';
  (w.history||[]).forEach(h=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${h.date||'‚Äî'}</td><td>${h.method}</td><td>${fmtMoney(h.amount)}</td><td>${h.status||'‚Äî'}</td>`;
    tb.appendChild(tr);
  });
}

async function loadMonitoring(){
  const m = await api('monitoring');
  $("#mon-health").textContent = m.health || '‚Äî';
  $("#mon-maint").textContent  = m.maintenance || '‚Äî';
  const tb=$("#mon-events"); tb.innerHTML='';
  (m.events||[]).forEach(e=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${e.time}</td><td>${e.type||'system'}</td><td>${e.message||''}</td>`;
    tb.appendChild(tr);
  });
}

async function loadSettings(){
  const cfg = await api('config').catch(()=>({ok:false,note:"No config endpoint"}));
  $("#cfg").textContent = JSON.stringify(cfg, null, 2);
}

/* ================== BOOT ================== */
async function boot(){
  const route = (location.hash||'#dashboard').slice(1);
  show(route);
  try{
    if(route==='dashboard')  await loadDashboard();
    if(route==='cpa')        await loadCpa();
    if(route==='users')      await loadUsers();
    if(route==='analytics')  await loadAnalytics();
    if(route==='wallet')     await loadWallet();
    if(route==='monitoring') await loadMonitoring();
    if(route==='settings')   await loadSettings();
  }catch(e){
    console.error(e);
    alert("Failed to load: "+e.message);
  }
}
window.addEventListener('load',boot);
window.addEventListener('hashchange',boot);
</script>
</body>
</html>