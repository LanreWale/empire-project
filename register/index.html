<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Empire â€“ Registration</title>
<style>
:root{--bg:#0b1220;--card:#121a2b;--muted:#96a0b5;--ok:#18b26b;--bad:#de524c;--txt:#e7ecf7;--accent:#4bb1ff}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--txt);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:720px;margin:0 auto;padding:24px}
.card{background:var(--card);border-radius:16px;box-shadow:0 6px 40px rgba(0,0,0,.25);padding:24px}
h1{margin:0 0 8px}.muted{color:var(--muted)}
.msg{padding:12px 14px;border-radius:12px;margin:12px 0}
.msg.ok{background:#0f2b21;border:1px solid #166c4a;color:#b9f4d8}
.msg.bad{background:#2a1414;border:1px solid #7a3431;color:#ffd7d5}
button{background:var(--accent);border:0;color:#07111f;padding:12px 16px;border-radius:12px;font-weight:600;cursor:pointer}
input{width:100%;padding:12px 14px;border:1px solid #1f2a42;background:#0d1525;color:#dfe8fb;border-radius:10px}
label{display:block;margin:10px 0 6px}
</style>
<link rel="stylesheet" href="/assets/css/empire-style.css">
<script src="/assets/js/empire-frame.js" defer></script>
<link rel="stylesheet" href="/assets/css/empire-style.css">
<script src="/assets/js/empire-layout.js" defer></script>
</head><body>
<div class="wrap"><div class="card">
  <h1>Empire Registration</h1>
  <p class="muted">Opening a personal invite. Invites expire after 48 hours.</p>
  <div id="msg" class="msg" style="display:none"></div>

  <label>Full name</label>
  <input id="name" placeholder="Your full name"/>

  <label>Email</label>
  <input id="email" placeholder="you@example.com" autocomplete="email"/>

  <label>Phone (WhatsApp)</label>
  <input id="phone" placeholder="+234..." autocomplete="tel"/>

  <div style="margin-top:14px"><button id="submitBtn">Submit Registration</button></div>
</div></div>

<script>
(async function(){
  const $ = (id)=>document.getElementById(id);
  const show = (el, cls, text)=>{ el.className='msg '+cls; el.textContent=text; el.style.display='block'; };

  // get invite token from URL or sessionStorage
  const usp=new URLSearchParams(location.search);
  const token = usp.get('i') || sessionStorage.getItem('empire.invite') || '';
  if(token) sessionStorage.setItem('empire.invite', token);

  // verify invite first
  try{
    if(!token) throw new Error('Missing invite token.');
    const r = await fetch('/.netlify/functions/invite-verify?code=' + encodeURIComponent(token));
    const j = await r.json();
    if(!j.ok) throw new Error(j.error || 'Invite invalid.');
    // prefill
    if(j.claims){
      $('name').value  = j.claims.name  || '';
      $('email').value = j.claims.email || '';
      $('phone').value = j.claims.phone || '';
    }
    show($('msg'),'ok','Invite verified. You can complete the form.');
  }catch(e){
    show($('msg'),'bad','TypeError: '+(e.message||e));
  }

  $('submitBtn').onclick = async ()=>{
    try{
      const payload = {
        name: $('name').value.trim(),
        email: $('email').value.trim(),
        phone: $('phone').value.trim(),
        token
      };
      // Here you would call your own registration function if needed.
      // For now, just log to Sheets via gs-bridge as a success event.
      await fetch('/.netlify/functions/gs-bridge', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ action:'append', sheet:'Event_Log',
          values:[new Date().toISOString(),'User','Registration submit', payload.email||payload.phone] })
      });
      show($('msg'),'ok','Thanks! Your registration has been received.');
    }catch(err){
      show($('msg'),'bad', String(err));
    }
  };
})();
</script>
</body></html>
