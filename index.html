<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>⚔️ THE EMPIRE — Command Dashboard ⚔️</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background:#0b0c10; color:#fff; margin:0; }
    header { padding:1rem; background:#1f2833; text-align:center; font-size:1.5rem; font-weight:bold; }
    nav { display:flex; justify-content:center; background:#45a29e; }
    nav button { flex:1; padding:1rem; border:none; background:#45a29e; color:white; font-size:1rem; cursor:pointer; }
    nav button.active { background:#66fcf1; color:#000; }
    section { display:none; padding:1rem; }
    section.active { display:block; }
    table { width:100%; border-collapse:collapse; margin-top:1rem; }
    th, td { padding:0.5rem; border:1px solid #45a29e; text-align:left; }
    .metric { display:inline-block; margin:1rem; padding:1rem; background:#1f2833; border-radius:8px; }
    .emp-modal.hidden { display:none; }
    .emp-modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; }
    .emp-modal__panel { background:#1f2833; padding:1.5rem; border-radius:8px; width:400px; max-width:90%; }
    .emp-field { margin-bottom:1rem; }
    .emp-label { display:block; margin-bottom:0.5rem; }
    .emp-input { width:100%; padding:0.5rem; }
    .emp-btn { padding:0.5rem 1rem; margin:0.25rem; }
    .emp-btn-primary { background:#66fcf1; border:none; color:#000; cursor:pointer; }
  </style>
</head>
<body>
  <header>⚔️ THE EMPIRE — Command Dashboard ⚔️</header>
  <nav>
    <button data-tab="overview" class="active">Overview</button>
    <button data-tab="cpa">CPA Accounts</button>
    <button data-tab="analytics">Analytics</button>
    <button data-tab="wallet">Wallet</button>
    <button data-tab="leads">Leads</button>
  </nav>

  <!-- Overview -->
  <section id="overview" class="active">
    <h2>Overview</h2>
    <div id="overview-metrics">
      <div class="metric">Total Earnings: <span id="ov-earnings">$0</span></div>
      <div class="metric">Total Leads: <span id="ov-leads">0</span></div>
      <div class="metric">Total Clicks: <span id="ov-clicks">0</span></div>
      <div class="metric">Conversion Rate: <span id="ov-cr">0%</span></div>
    </div>
  </section>

  <!-- CPA Accounts -->
  <section id="cpa">
    <h2>CPA Accounts</h2>
    <button id="open-add-cpa" class="emp-btn emp-btn-primary">+ Add Account</button>
    <table>
      <thead>
        <tr><th>ID</th><th>Network</th><th>Domain</th><th>Offers</th><th>Revenue</th><th>Clicks</th><th>CR%</th></tr>
      </thead>
      <tbody id="cpa-list"></tbody>
    </table>
  </section>

  <!-- Analytics -->
  <section id="analytics">
    <h2>Analytics</h2>
    <div class="metric">EPC: <span id="an-epc">$0</span></div>
    <div class="metric">CPA: <span id="an-cpa">$0</span></div>
    <div class="metric">RPM: <span id="an-rpm">$0</span></div>
  </section>

  <!-- Wallet -->
  <section id="wallet">
    <h2>Wallet</h2>
    <div class="metric">Balance: <span id="wa-balance">$0</span></div>
    <div class="metric">Last Payout: <span id="wa-last">$0</span></div>
  </section>

  <!-- Leads -->
  <section id="leads">
    <h2>Leads</h2>
    <table>
      <thead><tr><th>ID</th><th>Offer</th><th>Country</th><th>Revenue</th></tr></thead>
      <tbody id="leads-list"></tbody>
    </table>
  </section>

  <!-- Modal -->
  <div id="emp-cpa-modal" class="emp-modal hidden">
    <div class="emp-modal__panel">
      <h3>Add New CPA Account</h3>
      <form id="emp-cpa-form">
        <div class="emp-field"><label class="emp-label">Account ID</label><input class="emp-input" name="AccountID" required></div>
        <div class="emp-field"><label class="emp-label">Network</label>
          <select class="emp-input" name="Network" required>
            <option value="CPA Grip">CPA Grip</option>
            <option value="CPAlead">CPAlead</option>
            <option value="AdWorkMedia">AdWorkMedia</option>
            <option value="OGAds">OGAds</option>
          </select>
        </div>
        <div class="emp-field"><label class="emp-label">Custom Domain</label><input class="emp-input" name="Domain"></div>
        <div class="emp-field"><label class="emp-label">Active Offers</label><input class="emp-input" name="ActiveOffers" type="number"></div>
        <div class="emp-field"><label class="emp-label">Revenue</label><input class="emp-input" name="Revenue" type="number" step="0.01"></div>
        <div class="emp-field"><label class="emp-label">Clicks</label><input class="emp-input" name="Clicks" type="number"></div>
        <div class="emp-field"><label class="emp-label">Conversion Rate</label><input class="emp-input" name="ConversionRate" type="number" step="0.01"></div>
        <div><button type="button" class="emp-btn" id="close-cpa">Cancel</button><button type="submit" class="emp-btn emp-btn-primary">Save</button></div>
      </form>
    </div>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbwZVlGMvYonfCNdQlwPHiqqgOVC80_HsyktSYmqmQPBKmRrlzg_yo4lKz_Mmu85B7eY/exec";

    // Tabs
    document.querySelectorAll("nav button").forEach(btn=>{
      btn.addEventListener("click",()=>{
        document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        document.querySelectorAll("section").forEach(sec=>sec.classList.remove("active"));
        document.getElementById(btn.dataset.tab).classList.add("active");
      });
    });

    // Modal
    const modal=document.getElementById("emp-cpa-modal");
    document.getElementById("open-add-cpa").onclick=()=>modal.classList.remove("hidden");
    document.getElementById("close-cpa").onclick=()=>modal.classList.add("hidden");
    function closeModal(){ modal.classList.add("hidden"); }

    // Fetch overview
    async function loadOverview(){
      const res=await fetch(GAS_URL+"?action=overview");
      const j=await res.json();
      if(j.ok){
        document.getElementById("ov-earnings").textContent="$"+j.totals.earnings;
        document.getElementById("ov-leads").textContent=j.totals.leads;
        document.getElementById("ov-clicks").textContent=j.totals.clicks;
        document.getElementById("ov-cr").textContent=j.totals.conversionRate+"%";
      }
    }

    // Fetch CPA
    async function loadCpa(){
      const res=await fetch(GAS_URL+"?action=getcpa");
      const j=await res.json();
      if(j.ok){
        const tbody=document.getElementById("cpa-list"); tbody.innerHTML="";
        j.items.forEach(r=>{
          const tr=document.createElement("tr");
          tr.innerHTML=`<td>${r.account}</td><td>${r.network}</td><td>${r.domain}</td><td>${r.activeOffers}</td><td>$${r.revenue}</td><td>${r.clicks}</td><td>${r.conversionRate}</td>`;
          tbody.appendChild(tr);
        });
      }
    }

    // Form submit
    document.getElementById("emp-cpa-form").addEventListener("submit",async e=>{
      e.preventDefault();
      const data=Object.fromEntries(new FormData(e.target).entries());
      const payload={action:"addcpa",...data};
      try{
        const res=await fetch(GAS_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
        const j=await res.json();
        if(!j.ok) throw new Error(j.error||"Add failed");
        alert("CPA account added ✔");
        closeModal(); loadCpa();
      }catch(err){ alert("Add CPA failed: "+err.message); }
    });

    loadOverview(); loadCpa();
  </script>
</body>
</html>