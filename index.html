<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Empire Hub â€” Login</title>
  <meta name="color-scheme" content="dark" />
  <style>
    :root{--bg:#0b1220;--panel:#101a2c;--ink:#e8eefc;--muted:#9fb2d1;--line:#1f2b44;--ring:#2f3b58;--gold1:#ffd24d;--gold2:#ffb11a;--blue1:#367cff;--blue2:#215de7}
    *{box-sizing:border-box} body{margin:0;background:#0b1220;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif}
    .wrap{max-width:720px;margin:0 auto;padding:28px 14px 48px}
    .hero{background:linear-gradient(180deg, rgba(255,255,255,.02), transparent),var(--panel);border:1px solid var(--line);border-radius:24px;padding:20px}
    .brand{display:flex;gap:12px;align-items:center}
    .badge{width:44px;height:44px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,#22c55e,#60a5fa);color:#001;font-weight:800}
    .title{font-size:18px;font-weight:700}
    .sub{color:var(--muted);margin-top:6px}
    .links a{color:#a7c8ff;text-decoration:none;margin-right:16px}
    .card{background:#0f182a;border:1px solid var(--line);border-radius:16px;padding:18px;margin-top:16px}
    label{display:block;font-size:13px;color:#cfe0ff;margin:10px 0 6px}
    input{width:100%;background:#0b162a;color:#e8eefc;border:1px solid var(--ring);border-radius:12px;padding:14px 12px}
    .btn{display:block;width:100%;text-align:center;padding:14px 16px;border-radius:12px;border:0;cursor:pointer;font-weight:800;color:#1b1606;background:linear-gradient(180deg,var(--gold1),var(--gold2))}
    .muted{color:var(--muted)} .note{margin-top:10px;padding:12px;border-radius:12px;display:none}
    .ok{background:#0f2a18;border:1px solid #1e5d38;color:#b7f7c3} .err{background:#2a0f13;border:1px solid #5d1e28;color:#ffb4c0}
    .footer{opacity:.7;text-align:center;margin-top:24px;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="brand">
        <div class="badge">â–²</div>
        <div>
          <div class="title">Empire Hub</div>
          <div class="sub">Secure entry for Commander, Approved Users, and Onboarding.</div>
        </div>
      </div>
      <div class="links" style="margin-top:10px">
        <a href="/dashboard.html">User Dashboard</a>
        <a href="https://t.me/TheEmpireHq" target="_blank" rel="noopener">Telegram: @TheEmpireHq</a>
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px">Supreme Command Login</h2>
      <p class="muted" style="margin:0 0 12px">Enter Admin PIN to access the dashboard.</p>

      <label for="pin">Admin PIN</label>
      <input id="pin" placeholder="GENERALISIMO@2025" autocomplete="off" />
      <button id="loginBtn" class="btn" type="button">Enter Command Center</button>

      <div id="msgOk" class="note ok">PIN accepted. Redirectingâ€¦</div>
      <div id="msgErr" class="note err">Login failed.</div>
    </div>

    <div class="footer">Â© Empire Affiliate Marketing Hub</div>
  </div>

  <script>
    // ðŸ”§ Set this to your auth endpoint that exchanges PIN â†’ token.
    // It must return JSON: { ok: true, token: "..." } on success.
    const AUTH_URL = "/api/auth/login"; // <-- adjust if different
    const TOKEN_KEY = "EMPIRE_TOKEN";
    const PIN_KEY   = "CMD_USER"; // still keep for compatibility

    async function login() {
      const pin = (document.getElementById('pin').value || "").trim();
      const okEl = document.getElementById('msgOk');
      const errEl = document.getElementById('msgErr');
      okEl.style.display = "none"; errEl.style.display = "none";

      if (!pin) { errEl.textContent = "Enter your PIN."; errEl.style.display="block"; return; }

      try {
        // Call backend to get token
        const res = await fetch(AUTH_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ pin })
        });
        const data = await res.json().catch(()=>({ok:false,error:"Bad JSON"}));
        if (!res.ok || !data.ok || !data.token) {
          throw new Error(data?.error || "Invalid PIN");
        }

        // Save token (+ PIN for legacy endpoints if needed)
        try { localStorage.setItem(TOKEN_KEY, data.token); } catch {}
        try { localStorage.setItem(PIN_KEY, pin); } catch {}

        okEl.style.display = "block";
        setTimeout(()=>{ window.location.href = "/dashboard.html"; }, 600);
      } catch (e) {
        errEl.textContent = e.message || "Login failed.";
        errEl.style.display = "block";
      }
    }

    document.getElementById('loginBtn').addEventListener('click', login);
    document.getElementById('pin').addEventListener('keydown', (e)=>{ if(e.key==="Enter"){ login(); }});

    // If already logged in, go straight to dashboard
    try {
      const existing = localStorage.getItem(TOKEN_KEY);
      if (existing) window.location.replace("/dashboard.html");
    } catch {}
  </script>
</body>
</html>