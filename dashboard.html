<script>
// REPLACE the existing loadWallet() with this one
async function loadWallet(){
  const j = await getJSON(API.wallet);

  // normalize fields coming from either schema
  const inflow      = Number(j?.inflow ?? 0);
  const outflow     = Number(j?.outflow ?? 0);
  const processing  = Number(j?.processing ?? 0);
  const net         = Number(j?.net ?? (inflow - outflow - processing));
  const available   = Number(j?.available ?? j?.balance ?? net);
  const withdrawal  = Number(j?.withdrawal ?? outflow);

  // write KPI cards
  $('#w-available').textContent = money(available);
  $('#w-withdraw').textContent  = money(withdrawal);
  $('#w-proc').textContent      = money(processing);
  $('#w-remaining').textContent = money(net);

  // support multiple item keys and shapes
  const items = Array.isArray(j?.items) ? j.items
              : Array.isArray(j?.transactions) ? j.transactions
              : [];

  const tb = $('#wallet-rows'); tb.innerHTML = '';
  if(items.length){
    items.forEach(x=>{
      const date   = x.date ?? x.ts ?? '';
      const amount = Number(x.amount ?? x.value ?? 0);
      const method = x.method ?? x.channel ?? x.bank ?? '';
      const status = (x.status ?? '').toString();
      const isDone = /done|paid|complete/i.test(status);
      tb.insertAdjacentHTML('beforeend',
        `<tr>
           <td>${date}</td>
           <td>${money(amount)}</td>
           <td>${method}</td>
           <td><span class="pill ${isDone?'ok':'bad'}">${status || 'PENDING'}</span></td>
         </tr>`
      );
    });
  }else{
    tb.innerHTML = `<tr><td colspan="4" class="muted">No wallet entries.</td></tr>`;
  }
}
</script>