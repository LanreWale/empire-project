<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Empire Control â€” Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/assets/brand/favicon.ico" />
  <link rel="stylesheet" href="/assets/css/empire-style.css" />

  <!-- Charts (if used by your dashboard JS) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>

  <!-- Auth must load BEFORE anything else -->
  <script src="/js/empire-auth.js"></script>
  <script>
    if (!window.EmpireAuth?.has()) {
      window.location.replace("/login.html");
    }
  </script>

  <!-- Shared shell + (optionally) your dashboard logic -->
  <script src="/assets/js/empire-shell.js" defer></script>
  <!-- If you have a dedicated dashboard script, include it here -->
  <!-- <script src="/assets/js/empire-dashboard.js" defer></script> -->
</head>
<body>
  <header id="emp-header" class="emp-header"></header>

  <main id="emp-dashboard" class="emp-container">
    <nav class="emp-nav" aria-label="Empire sections" style="margin:16px 0; display:flex; gap:8px; flex-wrap:wrap;">
      <a href="#dashboard"  data-tab="dashboard"  class="emp-tab active">Overview</a>
      <a href="#cpa"        data-tab="cpa"        class="emp-tab">CPA Accounts</a>
      <a href="#users"      data-tab="users"      class="emp-tab">Users</a>
      <a href="#analytics"  data-tab="analytics"  class="emp-tab">Analytics</a>
      <a href="#wallet"     data-tab="wallet"     class="emp-tab">Wallet</a>
      <a href="#security"   data-tab="security"   class="emp-tab">Security</a>
      <a href="#monitoring" data-tab="monitoring" class="emp-tab">Monitoring</a>
      <span style="flex:1"></span>
      <button id="emp-logout" class="emp-btn small">Logout</button>
    </nav>

    <section id="view-dashboard"  class="emp-view"></section>
    <section id="view-cpa"        class="emp-view hidden"></section>
    <section id="view-users"      class="emp-view hidden"></section>
    <section id="view-analytics"  class="emp-view hidden"></section>
    <section id="view-wallet"     class="emp-view hidden"></section>
    <section id="view-security"   class="emp-view hidden"></section>
    <section id="view-monitoring" class="emp-view hidden"></section>
  </main>

  <footer id="emp-footer" class="emp-footer"></footer>

  <script>
    document.addEventListener("click", (ev) => {
      const a = ev.target.closest(".emp-tab");
      if (!a) return;
      ev.preventDefault();
      document.querySelectorAll(".emp-tab").forEach(t => t.classList.remove("active"));
      a.classList.add("active");
      const key = a.dataset.tab || "dashboard";
      document.querySelectorAll(".emp-view").forEach(v => v.classList.add("hidden"));
      const target = document.getElementById(`view-${key}`) || document.getElementById("view-dashboard");
      target.classList.remove("hidden");
      window.dispatchEvent(new CustomEvent("empire:tabchange", { detail: { tab: key }}));
    });

    document.getElementById("emp-logout")?.addEventListener("click", () => {
      try { window.EmpireAuth?.clear(); } catch {}
      location.href = "/login.html";
    });

    window.addEventListener("DOMContentLoaded", () => {
      const hash = (location.hash || "").replace(/^#/, "") || "dashboard";
      const starter = document.querySelector(`.emp-tab[data-tab="${hash}"]`) || document.querySelector('.emp-tab[data-tab="dashboard"]');
      starter?.click();
    });
  </script>
</body>
</html>