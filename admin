<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Empire – Admin</title>
<style>
:root{--bg:#0b1220;--card:#121a2b;--muted:#96a0b5;--ok:#18b26b;--bad:#de524c;--txt:#e7ecf7;--accent:#4bb1ff}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--txt);font:16px/1.5 system-ui,Segoe UI,Roboto,Arial}
.wrap{max-width:720px;margin:0 auto;padding:14px}
.card{background:var(--card);border-radius:16px;box-shadow:0 6px 40px rgba(0,0,0,.25);padding:16px;margin:12px 0}
h1,h2{margin:0 0 10px} .muted{color:var(--muted)}
label{display:block;margin:10px 0 6px}
input,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #24304a;background:#0d1526;color:var(--txt)}
button{width:100%;padding:12px 14px;border-radius:12px;border:0;background:var(--accent);color:#001427;font-weight:700;cursor:pointer}
.row{display:grid;gap:10px;grid-template-columns:1fr 1fr}
.msg{padding:10px;border-radius:10px;margin:10px 0}
.ok{background:#0f2b21;border:1px solid #166c4a;color:#b9f4d8}
.bad{background:#2a1414;border:1px solid #703131;color:#ffd1d1}
small{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1>Empire – Admin</h1>
  <p class="muted">Mobile quick actions: approve users, set levels, send invites.</p>

  <div class="card">
    <h2>Send Invite</h2>
    <div class="row">
      <div>
        <label>Name</label>
        <input id="inv-name" placeholder="Jane Doe">
      </div>
      <div>
        <label>Email</label>
        <input id="inv-email" placeholder="jane@example.com">
      </div>
    </div>
    <label>Phone (WhatsApp, optional)</label>
    <input id="inv-phone" placeholder="+2348...">
    <label>Telegram handle (optional)</label>
    <input id="inv-tg" placeholder="@TheEmpireHq">
    <button id="btn-invite">Generate Invite</button>
    <div id="inv-out" class="msg muted"></div>
  </div>

  <div class="card">
    <h2>Approve User</h2>
    <div class="row">
      <div>
        <label>Name</label>
        <input id="appr-name" placeholder="User name">
      </div>
      <div>
        <label>Email</label>
        <input id="appr-email" placeholder="user@example.com">
      </div>
    </div>
    <label>Phone (WhatsApp)</label>
    <input id="appr-phone" placeholder="+2348...">
    <button id="btn-approve">Approve + Notify</button>
    <div id="appr-out" class="msg muted"></div>
  </div>

  <div class="card">
    <h2>Set Level (1-5, Commander=10)</h2>
    <div class="row">
      <div>
        <label>Email (or phone)</label>
        <input id="lvl-email" placeholder="user@example.com">
      </div>
      <div>
        <label>Level</label>
        <select id="lvl-level">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          <option value="10">10 (Commander)</option>
        </select>
      </div>
    </div>
    <label>Reason (optional)</label>
    <textarea id="lvl-reason" placeholder="Performance / policy / etc."></textarea>
    <button id="btn-level">Set Level</button>
    <div id="lvl-out" class="msg muted"></div>
    <small>Tip: protect with an <code>X-Cmd-User</code> header via a browser extension or use curl on phone.</small>
  </div>

  <p class="muted" style="text-align:center">© Empire</p>
</div>

<script>
const SITE = location.origin;

function show(el, cls, text){
  el.className = "msg " + cls;
  el.textContent = text;
}

document.getElementById("btn-invite").onclick = async () => {
  const out = document.getElementById("inv-out");
  out.textContent = "Working...";
  const r = await fetch(SITE + "/.netlify/functions/invite-create", {
    method: "POST",
    headers: { "content-type": "application/json" },
    body: JSON.stringify({
      name:  document.getElementById("inv-name").value.trim(),
      email: document.getElementById("inv-email").value.trim(),
      phone: document.getElementById("inv-phone").value.trim(),
      telegramHandle: document.getElementById("inv-tg").value.trim()
    })
  }).then(r=>r.json()).catch(e=>({ok:false,error:String(e)}));
  if(r.ok){
    show(out,"ok","Invite: " + r.inviteUrl);
  }else{
    show(out,"bad","Error: " + r.error);
  }
};

document.getElementById("btn-approve").onclick = async () => {
  const out = document.getElementById("appr-out");
  out.textContent = "Working...";
  const r = await fetch(SITE + "/.netlify/functions/approve-user", {
    method: "POST",
    headers: { "content-type": "application/json" },
    body: JSON.stringify({
      name:  document.getElementById("appr-name").value.trim(),
      email: document.getElementById("appr-email").value.trim(),
      phone: document.getElementById("appr-phone").value.trim(),
      approve: true
    })
  }).then(r=>r.json()).catch(e=>({ok:false,error:String(e)}));
  show(out, r.results ? "ok" : (r.ok ? "ok" : "bad"), JSON.stringify(r));
};

document.getElementById("btn-level").onclick = async () => {
  const out = document.getElementById("lvl-out");
  out.textContent = "Working...";
  const r = await fetch(SITE + "/.netlify/functions/user-level-set", {
    method: "POST",
    headers: {
      "content-type": "application/json",
      // If you configured CMD_USER, add it here manually (via an extension) or remove the check server-side
      // "X-Cmd-User": "your_admin_value"
    },
    body: JSON.stringify({
      email: document.getElementById("lvl-email").value.trim(),
      phone: document.getElementById("lvl-email").value.trim().startsWith("+") ? document.getElementById("lvl-email").value.trim() : "",
      level: Number(document.getElementById("lvl-level").value),
      reason: document.getElementById("lvl-reason").value.trim()
    })
  }).then(r=>r.json()).catch(e=>({ok:false,error:String(e)}));
  show(out, r.ok ? "ok" : "bad", r.ok ? "Level set ✓" : ("Error: " + r.error));
};
</script>
</body>
</html>