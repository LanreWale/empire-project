<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Empire â€“ Login</title>
<link rel="stylesheet" href="assets/css/empire-style.css">

<style>
:root{--bg:#0b1220;--card:#121a2b;--muted:#96a0b5;--txt:#e7ecf7;--accent:#4bb1ff}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--txt);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:720px;margin:0 auto;padding:24px}
.card{background:var(--card);border-radius:16px;box-shadow:0 6px 40px rgba(0,0,0,.25);padding:24px;text-align:center}
h1{margin:12px 0 8px}
.muted{color:var(--muted)}
.msg{padding:12px 14px;border-radius:12px;margin:12px 0;display:none}
.msg.bad{background:#2a1414;border:1px solid #7a3431;color:#ffd7d5}
button{background:var(--accent);border:0;color:#07111f;padding:12px 16px;border-radius:12px;font-weight:600;cursor:pointer}
input{width:100%;padding:12px 14px;border:1px solid #1f2a42;background:#0d1525;color:#dfe8fb;border-radius:10px}
label{display:block;margin:10px 0 6px}
a{color:var(--accent);text-decoration:none}
.logo-badge{margin-bottom:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="logo-badge">
      <img src="/app/assets/brand/commander_badge.png" alt="Supreme Command" width="84">
    </div>

    <h1>Empire Login</h1>
    <p class="muted">Enter your email or phone to begin. You must have a valid invite.</p>

    <div id="msg" class="msg bad"></div>

    <label for="identifier">Email or phone</label>
    <input id="identifier" autocomplete="email" placeholder="you@example.com or +234..." />

    <div style="margin-top:16px;display:flex;gap:12px;align-items:center;justify-content:center">
      <button id="nextBtn">Enter The Empire</button>
      <a id="goRegister" href="/register">Skip to registration</a>
    </div>
  </div>
</div>

<!-- LOAD AUTH FIRST -->
<script src="assets/js/empire-auth.js?v=7"></script>

<script>
(async () => {
  // carry invite token through
  const usp = new URLSearchParams(location.search);
  const invite = usp.get("i");
  if (invite) sessionStorage.setItem("empire.invite", invite);
  const tok = sessionStorage.getItem("empire.invite") || invite || "";
  if (tok) document.getElementById("goRegister").href = "/register?i=" + encodeURIComponent(tok);

  // already authed? jump to dashboard
  if (window.EmpireAuth && EmpireAuth.has()) {
    location.replace("dashboard.html");
    return;
  }

  const $input = document.getElementById("identifier");
  const $btn   = document.getElementById("nextBtn");
  const $msg   = document.getElementById("msg");

  $btn.addEventListener("click", async (ev) => {
    ev.preventDefault();
    $msg.style.display = "none";
    $msg.textContent = "";

    const id = ($input.value || "").trim();
    if (!id) {
      $msg.textContent = "Enter email or phone.";
      $msg.style.display = "block";
      return;
    }

    try {
      await EmpireAuth.login(id);            // stores API key + probes GAS
      location.href = "dashboard.html";      // success
    } catch (e) {
      console.error(e);
      $msg.textContent = "Access denied: unauthorized";
      $msg.style.display = "block";
    }
  });
})();
</script>
</body>
</html>