<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Empire — Dashboard</title>
  <meta name="color-scheme" content="dark" />
  <style>
    :root{--bg:#0b1220;--card:#111a2b;--ink:#e8eefc;--muted:#9ab;--line:#1f2b44;--ring:#2f3b58;--ok:#16a34a;--warn:#f59e0b;--down:#dc2626;--blue:#2b66f6}
    *{box-sizing:border-box} body{margin:0;background:#0b1220;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif}
    .wrap{max-width:1120px;margin:0 auto;padding:22px 14px 48px}
    h1{margin:8px 0 12px;font-size:32px}
    .muted{color:var(--muted)}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:14px 0 18px}
    .tab{padding:10px 12px;border:1px solid var(--ring);border-radius:12px;background:#0f1a2c;color:#cfe0ff;font-weight:700;cursor:pointer}
    .tab.active{background:#173054;border-color:#3962ff;color:#fff}
    .section{display:none}
    .section.active{display:block}
    .grid{display:grid;gap:14px;grid-template-columns:1fr} @media(min-width:760px){.grid{grid-template-columns:repeat(4,1fr)}}
    .kpi{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
    .kpi .label{color:var(--muted);font-size:13px}
    .kpi .value{font-size:24px;font-weight:800;margin-top:6px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{display:inline-block;background:var(--blue);color:#fff;padding:10px 14px;border-radius:10px;border:0;text-decoration:none;cursor:pointer}
    .btn-secondary{display:inline-block;background:#25304a;color:#d1d5db;padding:8px 12px;border-radius:10px;border:1px solid var(--ring);cursor:pointer}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--ring);font-size:12px}
    .badge{padding:6px 10px;border-radius:10px;font-size:12px;background:#25304a;border:1px solid var(--ring)}
    .b-ok{background:var(--ok)} .b-warn{background:var(--warn)} .b-down{background:var(--down)}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:10px;border-top:1px solid var(--line);text-align:left}
    label{display:block;font-size:13px;color:#cfe0ff;margin:10px 0 6px}
    input,select{width:100%;background:#0b162a;color:#e8eefc;border:1px solid var(--ring);border-radius:12px;padding:12px}
    .two{display:grid;grid-template-columns:1fr;gap:12px} @media(min-width:760px){.two{grid-template-columns:1fr 1fr}}
    .three{display:grid;grid-template-columns:1fr;gap:12px} @media(min-width:980px){.three{grid-template-columns:repeat(3,1fr)}}
    pre{background:#0a1426;border:1px solid var(--line);padding:12px;border-radius:12px;overflow:auto}
    .footer{opacity:.7;text-align:center;margin-top:22px;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Empire — Dashboard</h1>
    <div id="note" class="muted">Loading…</div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="overview">Overview</button>
      <button class="tab" data-tab="health">Health</button>
      <button class="tab" data-tab="users">Users</button>
      <button class="tab" data-tab="events">Events</button>
      <button class="tab" data-tab="wallet">Wallet</button>
    </div>

    <!-- OVERVIEW -->
    <section id="tab-overview" class="section active">
      <!-- Profile -->
      <div id="profile" class="card" style="display:none">
        <div class="row" style="justify-content:space-between">
          <div>
            <div id="name" style="font-weight:800;font-size:18px"></div>
            <div class="muted" id="contact"></div>
          </div>
          <div class="pill" id="status">—</div>
        </div>
        <div style="margin-top:10px">Scale: <span id="scale" style="font-weight:700">—</span>×</div>
      </div>

      <!-- KPIs -->
      <div class="grid">
        <div class="kpi"><div class="label">Total Earnings</div><div id="kpiEarnings" class="value">NGN 0.00</div></div>
        <div class="kpi"><div class="label">Active Users</div><div id="kpiUsers" class="value">0</div></div>
        <div class="kpi"><div class="label">Approval Rate</div><div id="kpiApproval" class="value">—</div></div>
        <div class="kpi"><div class="label">Pending Reviews</div><div id="kpiPending" class="value">0</div></div>
      </div>
    </section>

    <!-- HEALTH -->
    <section id="tab-health" class="section">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div style="font-weight:700">System Health</div>
          <button class="btn-secondary" id="refreshBtn" type="button">Refresh</button>
        </div>
        <div class="row" id="healthRow"></div>
      </div>

      <div class="card muted" id="raw" style="display:none">
        <div style="font-weight:700;margin-bottom:6px">Debug</div>
        <pre id="debug"></pre>
      </div>
    </section>

    <!-- USERS (old /admin merged here) -->
    <section id="tab-users" class="section">
      <div class="three">
        <!-- Create Invite -->
        <div class="card">
          <div style="font-weight:700;margin-bottom:6px">Create Invite</div>
          <form id="inviteForm">
            <label>Name</label><input id="inv-name" required />
            <label>Email</label><input id="inv-email" type="email" required />
            <label>Phone (WhatsApp, optional)</label><input id="inv-phone" />
            <label>Telegram (optional)</label><input id="inv-telegram" placeholder="@channel" />
            <div style="margin-top:12px" class="row"><button class="btn" type="submit">Generate Invite</button></div>
          </form>
          <div id="inviteLinkWrap" style="display:none;margin-top:10px">
            <label>Your Invite Link</label>
            <input id="inviteLink" readonly />
            <div class="row" style="margin-top:8px">
              <button class="btn-secondary" id="copyInvite" type="button">Copy</button>
              <a class="btn" id="waInvite" href="#" target="_blank" rel="noopener">Share on WhatsApp</a>
            </div>
          </div>
        </div>

        <!-- Approve User -->
        <div class="card">
          <div style="font-weight:700;margin-bottom:6px">Approve User</div>
          <form id="approveForm">
            <label>Name</label><input id="app-name" />
            <label>Email</label><input id="app-email" type="email" />
            <label>Phone (WhatsApp)</label><input id="app-phone" />
            <label>Approve?</label>
            <select id="app-decision">
              <option value="approve">Approve</option>
              <option value="reject">Reject</option>
            </select>
            <div style="margin-top:12px" class="row"><button class="btn" type="submit">Send Approval</button></div>
          </form>
        </div>

        <!-- Set Level -->
        <div class="card">
          <div style="font-weight:700;margin-bottom:6px">Set User Level</div>
          <form id="levelForm">
            <label>Email</label><input id="lvl-email" type="email" required />
            <label>Level</label>
            <select id="lvl-level">
              <option value="1">1x</option>
              <option value="2">2x</option>
              <option value="5">5x</option>
              <option value="10">10x</option>
            </select>
            <div style="margin-top:12px" class="row"><button class="btn" type="submit">Update Level</button></div>
          </form>
        </div>
      </div>
    </section>

    <!-- EVENTS -->
    <section id="tab-events" class="section">
      <div class="card">
        <div style="font-weight:700;margin-bottom:6px">Event Feed</div>
        <div id="feedEmpty" class="muted" style="padding:8px;display:none">No events yet.</div>
        <div style="overflow:auto">
          <table id="feedTable">
            <thead><tr class="muted"><th>Time</th><th>Type</th><th>Message</th><th>Ref</th><th>Actor</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- WALLET -->
    <section id="tab-wallet" class="section">
      <div class="two">
        <div class="card">
          <div style="font-weight:700;margin-bottom:6px">Payout</div>
          <form id="payoutForm">
            <label>Provider</label>
            <select id="provider"><option value="paystack">Paystack</option></select>
            <label>Bank</label>
            <select id="bankSelect"><option value="">Select bank</option></select>
            <label>Account Number</label><input id="acctNumber" inputmode="numeric" />
            <label>Amount (NGN)</label><input id="amount" inputmode="decimal" />
            <div style="margin-top:12px" class="row"><button class="btn" type="submit">Request Withdrawal</button></div>
          </form>
        </div>

        <div class="card">
          <div style="font-weight:700;margin-bottom:6px">Sheets Utilities</div>
          <div class="row" style="gap:10px">
            <button class="btn-secondary" id="btnSheetsPing" type="button">Sheets: Ping</button>
            <button class="btn-secondary" id="btnSheetsAppend" type="button">Sheets: Append Event</button>
          </div>
          <div id="sheetsMsg" class="muted" style="margin-top:10px"></div>
        </div>
      </div>
    </section>

    <div class="footer">© Empire Affiliate Marketing Hub</div>
  </div>

  <script>
    // Simple tab router
    const tabs = document.querySelectorAll('.tab');
    const sections = {
      overview: document.getElementById('tab-overview'),
      health: document.getElementById('tab-health'),
      users: document.getElementById('tab-users'),
      events: document.getElementById('tab-events'),
      wallet: document.getElementById('tab-wallet'),
    };
    function activate(key){
      tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab===key));
      Object.entries(sections).forEach(([k,el])=>{ el.classList.toggle('active', k===key); });
      // Let dashboard-live.js know which section is visible (optional)
      window.dispatchEvent(new CustomEvent('empire:tab', {detail:key}));
    }
    tabs.forEach(t=>t.addEventListener('click',()=>activate(t.dataset.tab)));
    // Deep-link ?tab=users etc.
    const urlTab = new URLSearchParams(location.search).get('tab');
    if (urlTab && sections[urlTab]) activate(urlTab);
  </script>

  <!-- Wire to the live data/logic -->
  <script type="module" src="./app/assets/js/dashboard-live.js"></script>
</body>
</html>