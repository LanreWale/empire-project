<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Empire – Commander Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Favicons & Social (static; no secrets) -->
  <link rel="icon" href="/app/assets/brand/logo.svg" type="image/svg+xml">
  <meta name="theme-color" content="#0b1220">
  <meta property="og:title" content="Empire – Commander Console">
  <meta property="og:description" content="Mobile-first controls for Invites, Approvals, Levels & Performance.">
  <meta property="og:image" content="https://empireaffiliatemarketinghub.com/app/assets/brand/og-image.png">

  <style>
    :root{
      /* Empire brand palette */
      --bg:#070d18;
      --card:#0f172a;
      --e-ink:#e7ecf7;
      --muted:#9aa7bf;
      --line:#1f2a44;
      --accent:#4bb1ff;
      --accent-2:#18b26b;
      --accent-3:#7c3aed;

      /* spacing & radius */
      --r:18px;
      --pad:18px;
      --shadow:0 10px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 100% -100%, rgba(75,177,255,.08), transparent 60%),
        radial-gradient(1000px 700px at -10% 120%, rgba(124,58,237,.08), transparent 60%),
        var(--bg);
      color:var(--e-ink);
      font:15px/1.6 Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    .wrap{max-width:980px;margin:0 auto;padding:20px}
    .grid{display:grid;gap:16px}
    .cards{display:grid;gap:16px;grid-template-columns:1fr}
    @media(min-width:960px){ .cards{grid-template-columns:1fr 1fr} }

    /* Brand hero */
    .hero{
      position:relative;
      border-radius:var(--r);
      padding:24px var(--pad);
      background:
        linear-gradient(135deg, rgba(75,177,255,.12), rgba(24,178,107,.10)),
        url("/app/assets/brand/bg-texture.png");
      background-size:cover; background-position:center;
      outline:1px solid var(--line);
      box-shadow:var(--shadow);
    }
    .hero-top{display:flex;align-items:center;gap:14px}
    .hero-logo{display:flex;align-items:center;gap:12px}
    .hero-logo img{width:42px;height:42px;display:block}
    .brand-title{font-weight:800;letter-spacing:.2px}
    .brand-sub{color:var(--muted);font-size:12.5px}
    .tag{margin-left:auto;background:#0b1220;border:1px solid var(--line);padding:6px 10px;border-radius:999px;color:#cfe1ff;font-size:12px}

    /* PIN row */
    .pinrow{display:flex;gap:10px;align-items:center;margin-top:12px}
    .pinrow input{flex:1}
    .watermark{position:absolute;right:12px;bottom:10px;opacity:.08;user-select:none;pointer-events:none}
    .watermark img{width:140px;height:auto;display:block}

    /* Cards */
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), transparent), var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      padding:var(--pad);
      box-shadow:var(--shadow);
    }
    .card h2{margin:0 0 10px;font-size:18px;letter-spacing:.2px}
    .muted{color:var(--muted)}
    label{display:block;margin:10px 0 6px;font-size:13px;color:#c5d2ea}
    input,select,textarea{
      width:100%; padding:12px 12px;
      border:1px solid #24304b; background:#0b1324; color:var(--e-ink);
      border-radius:12px; outline:none;
    }
    input::placeholder,textarea::placeholder{color:#6f7f9c}
    textarea{min-height:90px;resize:vertical}
    .row{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:660px){ .row{grid-template-columns:1fr 1fr} }

    /* Buttons */
    .btn{
      width:100%; padding:12px 14px; border:0; border-radius:12px; font-weight:700; cursor:pointer;
      color:#071423; background:linear-gradient(135deg,var(--accent), #34d399); transition:transform .06s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:#243147;color:#dbe4f7;width:auto}
    .btn.warning{background:linear-gradient(135deg,#ff6b6b,#f59e0b);color:#1a0f0f}

    .msg{padding:10px 12px;border-radius:12px;margin:10px 0;font-size:13px;border:1px solid transparent}
    .msg.ok{background:#0f2b21;border-color:#166c4a;color:#b9f4d8}
    .msg.bad{background:#2a1414;border-color:#944040;color:#ffd6d5}

    .hr{height:1px;background:var(--line);margin:16px 0}
    .footer{color:#8e9bb3;text-align:center;margin:18px 0 6px;font-size:12px}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#0d1a2a;color:#cfe1ff;border:1px solid #2a3d5c;font-size:12px}
    .flex{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <div class="wrap grid">

    <!-- BRAND HERO -->
    <div class="hero">
      <div class="hero-top">
        <div class="hero-logo">
          <!-- Prefer your SVG in /app/assets/brand/logo.svg ; below is a simple inline fallback -->
          <img src="/app/assets/brand/logo.svg" alt="Empire Logo" onerror="this.replaceWith(document.getElementById('empireInlineLogo').content.cloneNode(true))">
          <div>
            <div class="brand-title">Empire Affiliate Marketing Hub</div>
            <div class="brand-sub">Commander Console • Operate invites, approvals, levels & performance logs.</div>
          </div>
        </div>
        <span class="tag">Commander</span>
      </div>

      <!-- PIN row -->
      <div class="pinrow">
        <input id="pin" placeholder="Admin PIN (CMD_USER)" />
        <button id="savePin" class="btn secondary">Save</button>
        <button id="clearPin" class="btn secondary">Clear</button>
      </div>
      <div id="pinStatus" class="muted" style="margin-top:8px;font-size:12.5px"></div>

      <div class="watermark">
        <img src="/app/assets/brand/watermark.svg" alt="Empire">
      </div>
    </div>

    <!-- ACTION CARDS -->
    <div class="cards">

      <!-- Create Invite -->
      <div class="card">
        <h2>Create Invite <span class="pill">Short Link + Token</span></h2>
        <div class="row">
          <div>
            <label>Name</label>
            <input id="inv_name" placeholder="Full name" />
          </div>
          <div>
            <label>Email</label>
            <input id="inv_email" placeholder="email@example.com" type="email" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Phone (WhatsApp, optional)</label>
            <input id="inv_phone" placeholder="+23480..." />
          </div>
          <div>
            <label>Telegram (optional)</label>
            <input id="inv_tg" placeholder="@username" />
          </div>
        </div>
        <button id="btnInvite" class="btn">Generate Invite</button>
        <div id="inviteMsg" class="msg" style="display:none"></div>
      </div>

      <!-- Approve User -->
      <div class="card">
        <h2>Approve User <span class="pill">WhatsApp + Telegram</span></h2>
        <div class="row">
          <div>
            <label>Name</label>
            <input id="appr_name" placeholder="Full name" />
          </div>
          <div>
            <label>Email</label>
            <input id="appr_email" placeholder="email@example.com" type="email" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Phone (WhatsApp)</label>
            <input id="appr_phone" placeholder="+234803..." />
          </div>
          <div>
            <label>Approve?</label>
            <select id="appr_approve">
              <option value="true" selected>Approve</option>
              <option value="false">Reject</option>
            </select>
          </div>
        </div>
        <button id="btnApprove" class="btn">Send Approval</button>
        <div id="apprMsg" class="msg" style="display:none"></div>
      </div>

      <!-- Set Level -->
      <div class="card">
        <h2>Set User Level <span class="pill">1x–5x • 10x Commander</span></h2>
        <div class="row">
          <div>
            <label>Email</label>
            <input id="lvl_email" placeholder="user@example.com" type="email" />
          </div>
          <div>
            <label>Level</label>
            <select id="lvl_level">
              <option>1x</option><option>2x</option><option>3x</option><option>4x</option><option>5x</option>
              <option>10x (Commander)</option>
              <option>0x (Suspended)</option>
            </select>
          </div>
        </div>
        <label>Reason / Note</label>
        <input id="lvl_reason" placeholder="e.g., performance upgrade" />
        <button id="btnLevel" class="btn">Apply Level</button>
        <div id="lvlMsg" class="msg" style="display:none"></div>
      </div>

      <!-- Log Performance -->
      <div class="card">
        <h2>Log Performance <span class="pill">Sheets + Alerts</span></h2>
        <div class="row">
          <div>
            <label>Email</label>
            <input id="perf_email" placeholder="user@example.com" />
          </div>
          <div>
            <label>Level Snapshot</label>
            <select id="perf_level">
              <option>1x</option><option>2x</option><option>3x</option><option>4x</option><option>5x</option><option>10x</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Clicks</label>
            <input id="perf_clicks" type="number" inputmode="numeric" value="0" />
          </div>
          <div>
            <label>Conversions</label>
            <input id="perf_conversions" type="number" inputmode="numeric" value="0" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Revenue (USD)</label>
            <input id="perf_revenue" type="number" step="0.01" value="0" />
          </div>
          <div>
            <label>Notify</label>
            <select id="perf_notify">
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </div>
        </div>
        <label>Notes</label>
        <textarea id="perf_notes" placeholder="e.g., evening push"></textarea>
        <label>WhatsApp (optional)</label>
        <input id="perf_phone" placeholder="+234803..." />
        <button id="btnPerf" class="btn">Record Performance</button>
        <div id="perfMsg" class="msg" style="display:none"></div>
      </div>

    </div>

    <div class="footer">© Empire Affiliate Marketing Hub</div>
  </div>

  <!-- Inline SVG fallback (used only if /app/assets/brand/logo.svg fails) -->
  <template id="empireInlineLogo">
    <svg width="42" height="42" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Empire">
      <rect x="2" y="2" width="60" height="60" rx="14" fill="#0b1220" stroke="#25314D" stroke-width="2"/>
      <path d="M16 40L28 20L32 28L40 16L48 28" stroke="#4BB1FF" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="48" cy="28" r="3" fill="#18B26B"/>
    </svg>
  </template>

  <script>
    // ===== Utilities =====
    const $ = id => document.getElementById(id);
    const show = el => { el.style.display = ""; };
    const hide = el => { el.style.display = "none"; };
    const esc = s => String(s).replace(/[&<>]/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[ch]));

    // PIN (x-cmd-user) handling
    function getPIN(){ return localStorage.getItem("empire_cmd_user") || ""; }
    function setPIN(v){ localStorage.setItem("empire_cmd_user", v || ""); }
    function headerAuth(){ const p=getPIN(); return p?{ "x-cmd-user": p }:{}; }

    function setMsg(el, ok, dataOrText){
      const html = typeof dataOrText === "string"
        ? esc(dataOrText)
        : `<pre>${esc(JSON.stringify(dataOrText, null, 2))}</pre>`;
      el.className = "msg " + (ok ? "ok" : "bad");
      el.innerHTML = html;
      show(el);
    }

    $("savePin").onclick = () => {
      setPIN($("pin").value.trim());
      $("pinStatus").textContent = "PIN saved (used as x-cmd-user header).";
    };
    $("clearPin").onclick = () => {
      setPIN(""); $("pin").value = "";
      $("pinStatus").textContent = "PIN cleared.";
    };
    window.addEventListener("DOMContentLoaded", () => {
      $("pin").value = getPIN();
      $("pinStatus").textContent = getPIN() ? "PIN loaded." : "No PIN saved.";
    });

    async function callJSON(path, body, msgEl){
      try{
        hide(msgEl);
        const headers = { "content-type":"application/json", ...headerAuth() };
        const r = await fetch(path, { method:"POST", headers, body: JSON.stringify(body||{}) });
        const data = await r.json();
        setMsg(msgEl, data.ok !== false, data);
      }catch(e){
        setMsg(msgEl, false, String(e));
      }
    }

    // ===== Actions =====
    $("btnInvite").onclick = () => {
      const body = {
        name: $("inv_name").value.trim(),
        email: $("inv_email").value.trim(),
        phone: $("inv_phone").value.trim(),
        telegramHandle: $("inv_t